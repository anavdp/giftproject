<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title th:text="Login"></title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
</head>
<script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<body>
<h1>GIFT PROJECT</h1>
<form action="#" th:action="@{/home}" method="post">
    <label for="user">User</label>
    <input id="user" th:name="username" type="text" th:maxlength="76" required><br>
    <label for="password" th:maxlength="20">Password</label>
    <input id="password" th:name="password" type="password" required><br><br>
    <input id="bSignin" type="submit" value="SIGN IN">
</form>
<p><a th:href="@{/signup}">Sign up</a></p>
</body>
</html>
<script type="text/javascript">
    $( document ).ready(function() {
        $("#bSignin").click(function(e){
            e.preventDefault();
            let user = $("#user").val();
            let pass = $("#password").val();
            $.post("/home",{username: user, password: pass}, function(auth) {
                debugger;
                let token = auth.token;
                $.ajax({
                    xhrFields: { withCredentials: true },
                    method: "POST",
                    headers: {'Authorization': 'Bearer ' + token },
                    url: "/principal",
                    success: function(data){ window.location.href = "/principal"; }
                })
            }).fail(function(){
                console.log("Error en la autenticaci√≥n");
            });



/*            $.ajax({
                url: 'http://localhost:8080/home',
                method: 'post',
                contentType: 'application/json; charset=utf-8',
                data: data,
                beforeSend(request) {
                    request.setRequestHeader('Authorization', `Bearer ${tokenBase64}`);
                },
                success(data, text) {
                    console.log(data);
                },
                error(request, status, error) {
                    console.log(error)
                }
            });*/
        });
    });
</script>